1. Removed direct stock quantity editing in admin product screens:
   - Updated admin/products/edit.php to remove the Stock Quantity input field so product stock is no longer changed from the Products module UI.
   - Updated admin/products/update.php to stop reading, validating, and updating the stock_quantity column, leaving stock changes to be handled by inventory processes that record history.
   - Updated admin/products/create.php to remove the Stock Quantity field when creating products so new products do not get manual stock values directly from the product form.
   - Updated admin/products/store.php so inserts no longer include stock_quantity and instead rely on the database default (0), with a note that stock will be managed via Inventory/Restock and recorded in inventory_history.

2. Corrected revenue recognition rules for reports so cash revenue is counted only on delivery and online payments can be counted immediately:
   - Modified admin/reports/sales_report.php to compute sales using a WHERE condition that:
     * Includes orders where payment_method starts with 'Cash' only when order_status is 'Delivered'.
     * Includes orders with non-cash payment methods when order_status is not 'Cancelled'.
     * Keeps the existing date range filter and ordering.
   - Modified admin/reports/net_income_report.php to use the same revenue rules in all revenue-related queries:
     * Main revenue SUM(total_amount) for the selected period now follows the cash vs. non-cash logic.
     * Overall revenue (no date filter) uses the same conditions.
     * Last 30 days revenue (revenue_30) also uses the same conditions so that net income statistics are consistent.

3. Removed automatic user reactivation on login and replaced it with a warning to contact admin:
   - Simplified user/auth/login.php so it:
     * Selects users simply by email (without forcing is_active conditions in the SELECT).
     * On successful password verification, only logs in users whose is_active flag is 1.
     * For users with correct password but is_active == 0, sets an error message: "Your account is deactivated. Please contact the administrator to reactivate your account."
     * Removed the previous "reactivate" flow (session reactivate_user_id, Reactivate/Cancel buttons, and UPDATE users SET is_active = 1), along with the extra success message block.
   - Kept the overall login and redirect logic intact for active users and existing redirects (cart, admin dashboard, inventory dashboard, or index).

4. Refactored customer profile update so that edit_profile.php is UI-only and update_profile.php handles database logic:
   - Updated user/account/edit_profile.php to:
     * Load error and success messages from $_SESSION['error'] and $_SESSION['success'], then clear them, instead of handling POST validation itself.
     * Fetch the latest user record from the database each time (including profile_photo) for display.
     * Change the form action to post to update_profile.php while still using multipart/form-data for file upload.
   - Rewrote user/account/update_profile.php to perform all update logic:
     * Includes config and requireLogin() so only logged-in users can update their profiles.
     * Reads form fields (first_name, last_name, contact_number, password, confirm_password) and validates:
       - First and last name are required.
       - If a password is provided, it must match confirm_password and be at least 6 characters.
     * Loads the current profile_photo from users for the logged-in user.
     * Handles optional profile photo upload into assets/images/profiles/ with basic extension checks (jpg, jpeg, png, gif), creating the directory if needed.
       - On successful upload, deletes the old profile photo if it exists.
       - Saves the new relative path assets/images/profiles/... into the database.
     * Updates users with or without password change depending on whether a new password is supplied.
     * On success, updates session first_name and last_name and writes a "Profile updated successfully!" message into $_SESSION['success']; on failure, writes a message into $_SESSION['error'].
     * Redirects back to edit_profile.php at the end so the user always returns to the profile editing screen, with messages shown there.

5. Replaced correlated subquery with a join in the Discounts admin listing for better performance and clarity:
   - Changed admin/discounts/index.php so that:
     * It uses a LEFT JOIN between discount_codes (dc) and discount_usage (du).
     * It groups by dc.discount_id and calculates COUNT(du.usage_id) as times_used instead of using a SELECT COUNT(*) subquery for each row.
     * Preserved ordering by dc.created_at DESC and all existing columns used in the table.

6. Updated "My Orders" (customer) to hide internal order IDs and to use the v_order_details view:
   - Modified user/orders.php/index.php to:
     * Replace the query on orders joined with user_addresses with a query against v_order_details filtered by user_id.
     * Group by order_id and select order_id, order_date, order_status, total_amount, address_line1, city, and state, ordered by order_date DESC.
     * Remove the "Order ID" column from the table header and rows so customers only see Date, Shipping Address, Total Amount, Status, and Actions (the internal ID is still used in the View link but not displayed).

7. Switched the Order Details (customer view) to use the order details database view while still showing product images:
   - Updated user/orders.php/view.php to:
     * Replace separate queries (orders + user_addresses and order_items + products) with a single query that selects from v_order_details (aliased as v) and LEFT JOINs products (p) for image_url.
     * Filter the new query by both order_id and user_id to enforce that users only see their own orders.
     * Collect all result rows into an array, with the first row used as the order-level info (dates, address, totals, status, payment method).
     * Build an items array from rows that have an order_item_id so that each item can be displayed with product_name, quantity, unit_price, subtotal, and product image.
     * Adjust the review eligibility logic to iterate over the items array when checking for existing product_reviews (per product and order) when order_status is "Delivered".
     * Keep the layout (tables, totals, and "Back to Orders" link) functionally the same, but backed by the view for compliance with the view requirement.

8. Prevented status changes for orders that are already delivered:
   - Modified admin/orders/update_status.php so that when a POST is submitted:
     * It still validates the new status value and ensures it is one of Pending, Processing, Shipped, Delivered, or Cancelled.
     * Adds an extra check: if the current order_status is 'Delivered' and the new requested status is not 'Delivered', an error message "Delivered orders can no longer be updated." is set and no database update is performed.
     * Keeps the rest of the status update logic (history insert and email notification) unchanged for non-delivered orders.

9. Enabled profile photo upload when the admin creates a new user, consistent with editing a user:
   - Updated admin/users/create.php:
     * Added a file input for profile_photo with accept="image/*" and a short explanatory note under the contact number field.
     * Kept the form enctype as multipart/form-data (already present) so image uploads are properly supported.
   - Updated admin/users/store.php:
     * After validating required fields (email, password, first_name, last_name, role_id) and uniqueness of email, added logic to handle an optional profile photo upload.
     * If a file is provided and has no upload error, saves it under assets/images/profiles/, creating the directory if needed, and only allows jpg, jpeg, png, or gif extensions.
     * On successful move_uploaded_file, sets $profile_photo to the relative image path; otherwise, leaves it null.
     * If $profile_photo is set, inserts the new user record including the profile_photo column; otherwise, uses the previous insert statement without profile_photo.

10. Simplified and adjusted the Adjust Stock (admin) screen so it applies immediately and removes the "New Stock (Preview)" functionality:
   - Modified admin/inventory/adjust_stock.php to:
     * After a successful adjustment (stock update + inventory_history insert), redirect back to the same adjust_stock.php page with product_id and success=1 in the query string, instead of redirecting to the inventory index screen.
     * On initial variable setup, if $_GET['success'] is 1, set $success = 'Stock adjusted successfully!' so the page displays a success alert after redirect.
     * Removed the "New Stock (Preview)" section from the form, along with the PHP preview calculation, so new stock is no longer shown before applying.
     * Simplified the JavaScript by:
       - Keeping updateStockInfo() only to update the current stock display based on the selected product.
       - Keeping setQuantityChange() to adjust the quantity_change input up/down by the selected step.
       - Removing updateNewStockPreview() and the input event listeners tied to it, so no live preview of new stock is shown.
     * Left the basic quantity-change buttons and current stock display intact while fulfilling the requirement to avoid previewing the new stock.

11. Removed the Order Details admin report as requested:
   - Deleted admin/reports/order_details_report.php from the project so the report is no longer directly accessible.
   - Updated includes/admin_navbar.php:
     * Removed the "Order Details" report entry under the Reports dropdown menu.
     * Left the other report links (Sales, Inventory, Expenses, Net Income, Discounts, Users) unchanged.

12. Other notes and confirmations:
   - The v_order_details view definition in schema/schema.txt is now actively used on the customer side (My Orders list and Order Details screen), aligning the implementation with the documented schema.
   - Product stock changes are now consistently expected to flow through Restock and Adjust Stock (inventory_history is already recorded there), preventing silent stock changes without history from the Products module.
   - No advanced frameworks or complex patterns were added; all changes use straightforward PHP, basic SQL joins, and minimal JavaScript where already present.


